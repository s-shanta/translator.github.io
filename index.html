<!doctype html>
<html>

<head>
  <style>
    /* CSS comes here */
    body {
      font-family: arial;
    }

    button {
      padding: 10px;
      background-color: #6a67ce;
      color: #FFFFFF;
      border: 0px;
      cursor: pointer;
      border-radius: 5px;
    }

    #output {
      background-color: #F9F9F9;
      padding: 10px;
      width: 100%;
      margin-top: 20px;
      line-height: 30px;
    }

    input {
      padding: 10px;
      width: 300px;
      border-radius: 5px;
      border: solid 2px #BBB;
    }

    .hide {
      display: none;
    }

    .show {
      display: block;
    }

    .translated-ltr {
      margin-top: -40px;
    }

    .translated-ltr {
      margin-top: -40px;
    }

    .goog-te-banner-frame {
      display: none;
      margin-top: -20px;
    }

    .goog-logo-link {
      display: none !important;
    }

    .goog-te-gadget {
      color: transparent !important;
    }
  </style>
  <title>JavaScript Speech to Text</title>
</head>

<body>
  <!-- For speaking -->
  <h2>JavaScript Speech to Text</h2>
  <div id="google_translate_element"></div>
  <p>Click on the below button and speak something...</p>
  <p><button type="button" onclick="runSpeechRecognition()">Speech to Text</button> &nbsp; <span id="action"></span></p>
  <div id="output" class="hide"></div>

  <!-- for listening -->
  <h2>JavaScript Text to Speech</h2>
  <!-- <div><input type="text" id="text-to-speech" placeholder="Enter text to speak..."/></div> -->
  <div id="text-to-speech"></div>
  <!-- <div><button type="button" onclick="textToAudio()">Speak</button></div> -->
  <br />
  <button id="buttonOutput">Text to Speech</button>

  <!-- Javascripts       -->
  <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.0.0/firebase-database.js"></script>
  <script type="text/javascript">
    // Your web app's Firebase configuration
    var firebaseConfig = {
    apiKey: "AIzaSyAZjaec5Qm-C4oVf8KBB52leJgeeoo5lAc",
    authDomain: "patienttodoctor-63b2d.firebaseapp.com",
    databaseURL: "https://patienttodoctor-63b2d.firebaseio.com",
    projectId: "patienttodoctor-63b2d",
    storageBucket: "patienttodoctor-63b2d.appspot.com",
    messagingSenderId: "992653525810",
    appId: "1:992653525810:web:9a60fdb102cc6a77fb8d2b"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    //Firebase DB reference
    const db = firebase.database().ref('patient/' + '1');
    //Firebase Insert
    function fireBaseInsert(message) {
      console.log(message);
      db.set({
        idOfPatient: '1',
        message: message
      });
    }
    //Firebase Get
    function fireBaseGet() {
      db.on('value', function(snapshot){
        document.getElementById("text-to-speech").textContent = snapshot.val().message;
        // myFunction();
      });
    }
    fireBaseGet();
    /* JS for Speaking */
    function runSpeechRecognition() {
      // get output div reference
      var output = document.getElementById("output");
      // get action element reference
      var action = document.getElementById("action");
      // new speech recognition object
      var SpeechRecognition = SpeechRecognition || webkitSpeechRecognition;
      var recognition = new SpeechRecognition();
      recognition.lang = 'ja';

      // This runs when the speech recognition service starts
      recognition.onstart = function() {
        action.innerHTML = "<small>listening, please speak...</small>";
      };

      recognition.onspeechend = function() {
        action.innerHTML = "<small>stopped listening, hope you are done...</small>";
        recognition.stop();
      }

      // This runs when the speech recognition service returns result
      recognition.onresult = function(event) {
        var transcript = event.results[0][0].transcript;
        var confidence = event.results[0][0].confidence;
        output.innerHTML = "<b>Text:</b> " + transcript + "<br/> <b>Confidence:</b> " + confidence * 100 + "%";
        output.classList.remove("hide");
        fireBaseInsert(transcript);
      };
      // start recognition
      recognition.start();
    }
    /* JS for Listening */
    document.getElementById('buttonOutput').addEventListener('click',myFunction);
    function myFunction() {
      let msg = document.getElementById("text-to-speech").textContent;
      console.log(msg);

      let speech = new SpeechSynthesisUtterance();
      speech.lang = "en-US";

      speech.text = msg;
      speech.volume = 1;
      speech.rate = 1;
      speech.pitch = 1;

      window.speechSynthesis.speak(speech);
    }
  </script>
  <!-- For Translating -->
  <script type="text/javascript">
    function googleTranslateElementInit() {
      new google.translate.TranslateElement({
        pageLanguage: 'en'
      }, 'google_translate_element');
    }
  </script>
  <!-- For Translating -->
  <script type="text/javascript" src="https://uploads-ssl.webflow.com/5e6cdff43dea835e0d32f309/5e6ce61775d1ae4d0299ac82_translator.txt"></script>
  <!-- <script type="text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script> -->
</body>

</html>