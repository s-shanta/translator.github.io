<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
    <style>
        .words{
            background-color:yellow;
            width: 300px;
        }
    </style>
</head>
<body>
    <div id="google_translate_element"></div>
    <button class="btn">Get voice</button>
    <div class="words" contenteditable >sgjsfg</div>
    <br>
    Select Translated Voice: <select id='voiceList'></select> <br><br>
    <button class="btnSpeak">Translated voice</button>
    <script type="text/javascript">
        const btn = document.querySelector('.btn');
        const btnSpeak = document.querySelector('.btnSpeak');
        window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

        const recognition = new SpeechRecognition();
        recognition.lang = 'ja';
        recognition.interimResults = true;

        let p = document.createElement('p');
        const words = document.querySelector('.words');
        words.appendChild(p);

        recognition.addEventListener('result',e=>{
            const transcript = Array.from(e.results)
            .map(result => result[0])
            .map(result => result.transcript)
            .join('')

            p.textContent = transcript;
            if(e.results[0].isFinal){
                p=document.createElement('p');
                words.appendChild(p);
            }
        });
        
        recognition.addEventListener('end', recognition.start);
        btn.addEventListener('click',function(){
            words.textContent = 'start';
            recognition.start();
        });
        function googleTranslateElementInit() {
        new google.translate.TranslateElement({ pageLanguage: "ja" }, "google_translate_element");
        };
        


        var synth = window.speechSynthesis;
        var voices = [];

        PopulateVoices();
        if(speechSynthesis !== undefined){
            speechSynthesis.onvoiceschanged = PopulateVoices;
        }

        btnSpeak.addEventListener('click', ()=> {
            const text = document.querySelector('.words');
            console.log(text.textContent);
            var toSpeak = new SpeechSynthesisUtterance(text.textContent);
            var selectedVoiceName = voiceList.selectedOptions[0].getAttribute('data-name');
            voices.forEach((voice)=>{
                if(voice.name === selectedVoiceName){
                    toSpeak.voice = voice;
                }
            });
            synth.speak(toSpeak);
        });

        function PopulateVoices(){
            voices = synth.getVoices();
            var selectedIndex = voiceList.selectedIndex < 0 ? 0 : voiceList.selectedIndex;
            voiceList.innerHTML = '';
            voices.forEach((voice)=>{
                var listItem = document.createElement('option');
                listItem.textContent = voice.name;
                listItem.setAttribute('data-lang', voice.lang);
                listItem.setAttribute('data-name', voice.name);
                voiceList.appendChild(listItem);
            });

            voiceList.selectedIndex = selectedIndex;
        }

    </script>
    <script src="https://uploads-ssl.webflow.com/5e6cdff43dea835e0d32f309/5e6ce61775d1ae4d0299ac82_translator.txt"></script>
</body>
</html>